# CustomizeFishing 確率表

## カテゴリ一覧（優先度順）

| カテゴリ | 優先度 | 基本確率 | Quality | 必要条件 | 天候条件 | 状態 |
|---------|--------|----------|---------|----------|----------|------|
| dolphins_grace | 0 | 100.0% | 0 | 開水域、イルカの好意 | 晴れ | 有効 |
| skgkyr | 1 | 1.0% | 1 | 開水域、宝釣り=10、幸運=2 | 雷雨 | 有効 |
| god | 2 | 0.005% | 1 | 開水域、宝釣り6+、幸運2+ | 雨/雷雨 | 有効 |
| eternal | 3 | 0.01% | 1 | 開水域、宝釣り8+、幸運3+ | 雷雨 | 無効 |
| exotic | 4 | 0.05% | 1 | 開水域、宝釣り7+、幸運2+ | 雨/雷雨 | 無効 |
| relic | 5 | 0.1% | 1 | 開水域、宝釣り7+、幸運2+ | 雨/雷雨 | 無効 |
| mythic | 6 | 0.5% | 1 | 開水域、宝釣り6+、幸運2+ | 全天候 | 無効 |
| legendary | 7 | 0.75% | 1 | 開水域、宝釣り6+、幸運2+ | 全天候 | 有効 |
| epic | 8 | 3.0% | 1 | 開水域、宝釣り4+、幸運1+ | 全天候 | 有効 |
| rare | 9 | 10.0% | 0 | 開水域、宝釣り3+、幸運1+ | 全天候 | 有効 |
| uncommon | 10 | 20.0% | 0 | 開水域 | 全天候 | 無効 |
| common | 11 | 15.0% | -1 | 開水域、宝釣り≤10、幸運≤3 | 全天候 | 有効 |
| fish | 12 | 60.0% | -2 | 宝釣り≤10、幸運≤3 | 全天候 | 有効 |
| junk | 13 | 100.0% | -3 | 宝釣り≤10、幸運≤3 | 全天候 | 有効 |

## 幸運値計算

### 基本幸運値
| 種類 | 計算式 | 最大値 | 最大時ボーナス |
|------|---------|---------|----------------|
| **宝釣りエンチャント** | レベル × 0.08% | 10レベル | +0.80% |
| **幸運ポーション** | レベル × 0.05% | 10レベル | +0.50% |
| **装備幸運** | 値 × 0.1% | 6 | +0.60% |

### 天候ボーナス
| 天候 | ボーナス |
|------|----------|
| **晴れ** | +0.0% |
| **雨** | +0.4% |
| **雷雨** | +0.7% |

### タイミングボーナス
| ティア | 反応時間 | 倍率 | ボーナス |
|--------|----------|------|----------|
| **JUST** | 16.67ms以内 | 140% | +1.4% |
| **PERFECT** | 50ms以内 | 100% | +1.0% |
| **GREAT** | 300ms以内 | 80% | +0.8% |
| **GOOD** | 750ms以内 | 30% | +0.3% |
| **MISS** | 750ms超過 | 0% | +0.0% |

ベース幸運ボーナス: 1.0%

### 最大幸運値
理論上の最大幸運値（すべての条件が最大の場合）：
- 宝釣り10: **+0.80%**
- 幸運ポーション10: **+0.50%**
- 装備幸運6: **+0.60%**
- 雷雨: **+0.70%**
- JUSTタイミング: **+1.40%**
- **合計: +4.00%**

### 特殊効果
- **ダブルフィッシング**: 宝釣りLv10以上かつコンジットパワーLv2以上で発動
  - 釣り処理を2回実行（2つのアイテムを獲得可能）
  - タイミング判定は1回のみ（両方の釣りに適用）

## 確率計算式

```
最終確率 = floor(基本確率 + (Quality × 総幸運値))
```

- Quality > 0: 幸運が高いほど確率上昇
- Quality = 0: 幸運値の影響なし
- Quality < 0: 幸運が高いほど確率減少

### 計算例（最大幸運時）
総幸運値4.0%の場合：
- **skgkyr**: 1.0% + (1 × 4.0) = 5.0%
- **god**: 0.005% + (1 × 4.0) = 4.005%
- **legendary**: 0.75% + (1 × 4.0) = 4.75%
- **common**: 15.0% + (-1 × 4.0) = 11.0%
- **fish**: 60.0% + (-2 × 4.0) = 52.0%
- **junk**: 100.0% + (-3 × 4.0) = 88.0%

## 特殊カテゴリ詳細

### dolphins_grace（優先度0）
- イルカの好意エフェクトが必要
- 晴れの天候でのみ出現
- 開水域が必要
- 確率100%で確定出現

### skgkyr（優先度1）
- **超レア条件**: 宝釣りレベルがちょうど10、幸運エフェクトがちょうど2
- 雷雨時のみ出現
- 基本確率1%（最大幸運時は約5%）
- チェキ券アイテムを獲得

### god（優先度2）
- 最高レアリティ（有効なカテゴリの中で）
- 雨または雷雨時のみ出現
- 非常に低い基本確率（0.005%）
- 最大幸運時でも約4%

## 優先度システム

1. 条件を満たすカテゴリをすべて収集
2. 優先度順（数値が小さい順）にソート
3. 各カテゴリの最終確率を計算
4. 確率に基づいて重み付き抽選

優先度が同じ場合、config.ymlで先に定義されたカテゴリが優先されます。

## カテゴリ選択フロー

1. プレイヤーの状態をチェック（開水域、天候、エフェクト）
2. 条件を満たすカテゴリをフィルタリング
3. 各カテゴリの調整後確率を計算
4. 重み付き抽選でカテゴリを選択
5. 選択されたカテゴリのルートテーブルからアイテムを取得

## デバッグ情報

デバッグログは `plugins/CustomizeFishing/debug.log` に常時出力されます。
以下の情報が記録されます：

- 釣り開始時の条件（開水域、天候、エフェクト）
- タイミング判定結果とボーナス
- 幸運値の詳細な内訳
- 選択されたカテゴリと確率計算
- アイテムの置換情報
- ダブルフィッシングによるボーナス処理（2回目の釣り処理）

## アクションバー表示

### 通常の釣り成功時
1. **最初の1.5秒**: 釣ったアイテムのカテゴリメッセージ
2. **1.5秒後**: 確率情報とボーナス要因（%表示）

### ダブルフィッシング時
1. **即座**: 両方のカテゴリメッセージ `✨ CATEGORY1 | CATEGORY2 ✨`
2. **1秒後**: タイミング情報（例：`✨PERFECT✨ (+1.0 Luck)`）
3. **1.5秒後〜**: 1つ目の確率情報（アニメーション表示）
4. **完了後+0.5秒**: 2つ目の確率情報（アニメーション表示）
   - 例: `確率: 5.00% (基本: 1.00%) 宝釣り+0.80% 幸運+0.10% 雷雨+0.70% JUST+1.40% ✨ ダブルフィッシング x2 ✨`

## 注意事項

- 無効化されているカテゴリ（eternal、exotic、relic、mythic、uncommon）は選択されません
- common、fish、junkカテゴリには最大値制限（宝釣り≤10、幸運≤3）があり、高レベルプレイヤーでは出現しません
- Twilight Forestのrainy_cloudブロックが釣り針の真上にある場合、雨天候として扱われます
- ダブルフィッシング時は完全に独立した2回の釣り処理が実行され、それぞれ異なるアイテムを獲得可能
- ダブルフィッシング発動条件：宝釣りエンチャントLv10以上 かつ コンジットパワーLv2以上
- タイミングボーナスはGOODティア（750ms以内）からボーナスが付与されます