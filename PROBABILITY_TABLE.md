# CustomizeFishing 確率表

## カテゴリ一覧

| カテゴリ | 優先度 | 基本確率 | Quality | 条件 | 天気 | 状態 |
|---------|--------|----------|---------|------|------|------|
| dolphins_grace | 0 | 100.0% | 0 | 開水域+イルカの好意 | 晴れ | 有効 |
| skgkyr | 1 | 0.05% | 2 | 開水域+宝釣り10+幸運2+ | 雷雨 | 有効 |
| god | 2 | 0.05% | 1 | 開水域+宝釣り6+幸運2+ | 雨/雷雨 | 有効 |
| eternal | 3 | -% | - | - | - | 無効 |
| exotic | 4 | -% | - | - | - | 無効 |
| relic | 5 | -% | - | - | - | 無効 |
| mythic | 6 | -% | - | - | - | 無効 |
| legendary | 7 | 1.0% | 1 | 開水域+宝釣り6+幸運2+ | 全天候 | 有効 |
| epic | 8 | 5.0% | 1 | 開水域+宝釣り4+幸運1+ | 全天候 | 有効 |
| rare | 9 | 10.0% | 0 | 開水域+宝釣り3+幸運1+ | 全天候 | 有効 |
| uncommon | 10 | -% | - | - | - | 無効 |
| common | 11 | 15.0% | -2 | 開水域+宝釣り≤10+幸運≤3 | 全天候 | 有効 |
| treasure | 12 | 30.0% | -2 | 開水域+宝釣り≤10+幸運≤3 | 全天候 | 有効 |
| fish | 13 | 60.0% | -3 | 条件なし+宝釣り≤10+幸運≤3 | 全天候 | 有効 |
| junk | 14 | 100.0% | -3 | 条件なし+宝釣り≤10+幸運≤3 | 全天候 | 有効 |

## 幸運計算

### 基本幸運値
| 要素 | 計算式 | 最大値 | 最大ボーナス |
|------|---------|---------|-------------|
| **宝釣りエンチャント** | レベル × 0.08% | 10レベル | +0.80% |
| **幸運ポーション** | レベル × 0.05% | 10レベル | +0.50% |
| **装備幸運** | 値 × 0.1% | 6 | +0.60% |
| **経験値レベル** | レベル × 0.01% | 100レベル | +1.00% |

### 特殊幸運ボーナス
| 条件 | 計算式 | 説明 |
|------|---------|------|
| **宝釣りLv127以上** | 0.1 + (乱数 × コンジットレベル) | コンジットパワーレベルに応じた追加ランダムボーナス |

### 天気ボーナス
| 天気 | ボーナス |
|------|----------|
| **晴れ** | +0.0% |
| **雨** | +0.4% |
| **雷雨** | +0.7% |

### タイミングボーナス
| 判定 | 反応時間 | 倍率 | ボーナス |
|--------|----------|------|----------|
| **JUST** | 16.67ms以内 | 140% | +1.4% |
| **PERFECT** | 50ms以内 | 100% | +1.0% |
| **GREAT** | 300ms以内 | 80% | +0.8% |
| **GOOD** | 750ms以内 | 30% | +0.3% |
| **MISS** | 750ms超過 | 0% | +0.0% |

基本幸運ボーナス: 1.0%

### 最大幸運値計算

#### 通常時の最大幸運値
理論上の最大幸運値は5.0%となります：
- 宝釣り10: **+0.80%**
- 幸運ポーション10: **+0.50%**
- 装備幸運6: **+0.60%**
- 経験値100: **+1.00%**
- 雷雨: **+0.70%**
- JUSTタイミング: **+1.40%**
- **合計: +5.00%**

#### 特殊条件時の最大幸運値
宝釣りLv127以上の場合：
- 基本宝釣りボーナス: **+0.80%** (Lv10分)
- 特殊ランダムボーナス: **+0.1% ～ +(0.1% + コンジットレベル)**
- 例：コンジットパワーLv3時 → **+0.1% ～ +3.1%** の追加ボーナス
- その他のボーナス: **+4.20%** (幸運ポーション+装備+経験値+天気+タイミング)
- **理論上最大: 約8.0%** (運次第でそれ以上も可能)

### ダブルフィッシング
- **発動条件**: 宝釣りLv10以上かつコンジットパワーLv2以上
- **効果**:
  - 釣りが2回分同時に処理される
  - タイミング判定は1回だけ行い、両方の結果に適用される

## 確率計算式

```
補正後確率 = floor(基本確率 + (Quality × 幸運値))
```

- Quality > 0: 幸運値が高いほど有利
- Quality = 0: 幸運値の影響なし
- Quality < 0: 幸運値が高いほど不利

### 計算例

#### 通常時（幸運値5.0%時）
幸運値5.0%での各カテゴリの補正後確率：
- **skgkyr**: 1.0% + (2 × 5.0) = 11.0%
- **god**: 0.05% + (1 × 5.0) = 5.05%
- **legendary**: 1.0% + (1 × 5.0) = 6.0%
- **epic**: 5.0% + (1 × 5.0) = 10.0%
- **common**: 15.0% + (-2 × 5.0) = 5.0%
- **treasure**: 30.0% + (-2 × 5.0) = 20.0%
- **fish**: 60.0% + (-3 × 5.0) = 45.0%
- **junk**: 100.0% + (-3 × 5.0) = 85.0%

#### 特殊条件時（宝釣りLv127+、幸運値8.0%時）
幸運値8.0%での各カテゴリの補正後確率：
- **skgkyr**: 1.0% + (2 × 8.0) = 17.0%
- **god**: 0.05% + (1 × 8.0) = 8.05%
- **legendary**: 1.0% + (1 × 8.0) = 9.0%
- **epic**: 5.0% + (1 × 8.0) = 13.0%
- **common**: 15.0% + (-2 × 8.0) = 0.0% (選ばれない)
- **treasure**: 30.0% + (-2 × 8.0) = 14.0%
- **fish**: 60.0% + (-3 × 8.0) = 36.0%
- **junk**: 100.0% + (-3 × 8.0) = 76.0%

## 各カテゴリの詳細

### dolphins_grace（優先度0）
- イルカの好意エフェクト限定カテゴリ
- 晴れ天気のみで発動
- 開水域が必要
- 確率100%で最優先

### skgkyr（優先度1）
- **発動条件**: 宝釣り10以上、幸運エフェクト2以上
- 雷雨限定でのみ発動
- 基本確率1%、最大幸運値で9%
- Quality 2により幸運値で大幅に確率増加

### god（優先度2）
- 最も希少なアクティブカテゴリの一つ
- 雨または雷雨でのみ発動
- 非常に低い基本確率の0.05%
- 最大幸運値で4%

### treasure（優先度12）
- 新追加されたカテゴリ
- 基本確率30%でcommonより高い
- 開水域が必要、幸運制限あり
- Quality -2により幸運値で確率低下

## 優先度システム

1. 有効なカテゴリを条件でフィルタリング
2. 優先度の低い順にソート（数値昇順）
3. 各カテゴリの補正後確率を計算
4. 乱数で最初にヒットしたカテゴリを選択

優先度が低いほど先にチェックされるため、レアカテゴリが優先されます。

## カテゴリ選択例

1. プレイヤーが各種条件（開水域、天気、エンチャント）を満たす
2. 有効なカテゴリで補正確率が0より大きいものをリスト化
3. 優先度順にチェックし、確率判定で成功したカテゴリを決定
4. 乱数でヒットしたカテゴリのルートテーブルでアイテムを選択
5. 選択されたカテゴリの演出（パーティクル、音、花火、ポーション）を実行


## 注意事項

- 無効なカテゴリ（eternal、exotic、relic、mythic、uncommon）は選択されません
- common、treasure、fish、junkカテゴリには最大幸運制限（宝釣り≤10、幸運≤3）があり、高レベルエンチャントでは選ばれにくくなります
- Twilight ForestのRainy_Cloudブロックがウキの上空32ブロック以内にあると天気が雨扱いになります
- ダブルフィッシングは各結果が独立して処理され、最もレアなカテゴリのエフェクトが使用されます
- ダブルフィッシング発動時は宝釣りエンチャントLv10以上かつコンジットパワーLv2以上が必要です
- タイミングボーナスはGOOD判定（750ms以内）まで有効で、それを超えるとボーナスが得られません
- **宝釣りLv127以上の特殊処理**: 通常の宝釣りボーナス計算に加えて、コンジットパワーレベルに応じた追加ランダムボーナス（0.1% + 最大コンジットレベル分）が毎回ランダムに適用されます